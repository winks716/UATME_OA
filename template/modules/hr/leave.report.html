<{include file="header.html"}>
<{include file="topnav.html"}>

<style>
#report tr.location td{background-color:#6699cc;color:#ffffff;cursor:pointer;}
#report tr.department td{background-color:#99ccff;cursor:pointer;}
#report tr.employee td{background-color:#eeeeee;display:;}
#report tr.employee td.nonestyle{background:none;cursor:normal;}
#report tr.employee td.employee:hover{background-color:pink;display:;cursor:pointer;}
#report tr.employee td.nonestyle:hover{background:none;cursor:normal;}
#report tr.apply td.nonestyle{background:none;cursor:normal;}
#report tr.apply td.detail{background:none;cursor:normal;}
#report tr.apply td.detail table td{background:none;}
</style>

<div class="container">
<strong>年份</strong>
<select id="yearSelect">
<option <{if $yearSelect=="2012"}>selected<{/if}>>2012</option>
<option <{if $yearSelect=="2013"}>selected<{/if}>>2013</option>
<option <{if $yearSelect=="2014"}>selected<{/if}>>2014</option>
<option <{if $yearSelect=="2015"}>selected<{/if}>>2015</option>
<option <{if $yearSelect=="2016"}>selected<{/if}>>2016</option>
</select>
&nbsp;&nbsp;&nbsp;&nbsp;
<strong>时间</strong>
<select id="timeSelect">
<option value="0">-请选择-</option>
<option value="1" <{if $timeSelect=="1"}>selected<{/if}>>第一季度</option>
<option value="2" <{if $timeSelect=="2"}>selected<{/if}>>第二季度</option>
<option value="3" <{if $timeSelect=="3"}>selected<{/if}>>第三季度</option>
<option value="4" <{if $timeSelect=="4"}>selected<{/if}>>第四季度</option>
</select>
&nbsp;&nbsp;&nbsp;&nbsp;
<strong>假期类型</strong>
<select id="typeSelect">
<option value="0">-请选择-</option>
<{foreach from=$type item=t}>
<option value="<{$t.id}>" <{if $typeSelect==$t.id}>selected<{/if}>><{$t.name}></option>
<{/foreach}>
</select>
&nbsp;&nbsp;&nbsp;&nbsp;
<strong>员工</strong>
<select id="employeeSelect">
<option value="0">-请选择-</option>
<{foreach from=$employee item=e}>
<option value="<{$e.id}>" <{if $employeeSelect==$e.id}>selected<{/if}>><{$e.namezh}>(<{$e.name}>)</option>
<{/foreach}>
</select>
<span class="clickbtn reportSearch">[查看]</span>
</div>

<div class="container">
<table id="report">
<{foreach from=$location item=l}>
<{if $count["location_`$l.id`"]['count']!=0}>
<tr class="location"><td class="span-3"><{$l.name}> <{if $count["location_`$l.id`"]['count']!=0}><{$count["location_`$l.id`"]['count']}><{else}>0<{/if}></td><td></td></tr>
	<{foreach from=$department item=d}>
	<{if $d.location_id==$l.id && $count["department_`$d.id`"]['count']!=0}>
	<tr class="department"><td><{$d.name}> <{if $count["department_`$d.id`"]['count']!=0}><{$count["department_`$d.id`"]['count']}><{else}>0<{/if}></td><td></td></tr>
		<{foreach from=$employee item=e}>
		<{if $e.department_id==$d.id && $count["employee_`$e.id`"]['count']!=0}>
		<tr class="employee"><td class="nonestyle"></td><td class="employee" i="<{$e.id}>"><{$e.namezh}> (<{$e.name}>)  <{if $count["employee_`$e.id`"]['count']!=0}><{$count["employee_`$e.id`"]['count']}><{else}>0<{/if}></td></tr>
		<{/if}>
		<{/foreach}>
	<{/if}>
	<{/foreach}>
<{/if}>
<{/foreach}>
</table>
</div>

<{include file="declaration.html"}>
<{include file="footer.html"}>

<script type="text/javascript">
$(function(){
	$('tr.employee td.employee').click(function(){
		$('tr.apply').remove();
		var o = $(this);
		var id = $(o).attr('i');
		$(o).parent().after('<tr class="apply"><td class="nonestyle"></td><td class="detail">等待数据载入……</td></tr>');
		$.post('index.php?m=hr&s=report&a=get.employee.leave',{'id':id},function(data){
			var json = eval('(' + data + ')');
			if(json.httpstatus==200){
				$('tr.apply').find('td.detail').html(json.msg);
			}else{
				$('tr.apply').remove();
				alert(json.error);
			}
		})
	})
	
	$('.reportSearch').click(function(){
		window.location = 'index.php?m=hr&s=report&a=leave.apply.report&employeeSelect='+$('#employeeSelect').val()+'&yearSelect='+$('#yearSelect').val()+'&timeSelect='+$('#timeSelect').val()+'&typeSelect='+$('#typeSelect').val();
	})
})
</script>